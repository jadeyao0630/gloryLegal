<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="./css/jquery.mobile-1.4.5.min.css" />
	<link rel="stylesheet" href="./css/paging.css"/>
	<link rel="stylesheet" href="./css/all.css" />
	<link rel="stylesheet" href="./css/form.css" />
	<link rel="stylesheet" href="./css/popup.css" />
	<link rel="stylesheet" href="./css/color.css" />
	<link rel="stylesheet" href="./css/stepButton.css" />
	<script src="./js/jquery.js"></script>
	<script src="./js/jquery.mobile-1.4.5.min.js"></script>

	<script src="./js/jquery.table.hpaging.js"></script>
	<script src="./configs.js"></script>
	<script src="./js/db.js"></script>
	<script type="text/javascript" src="./js/tools.js"></script>
	
	<script type="text/javascript" src="./form.js"></script>
	<script type="text/javascript" src="./utilities/tables.js"></script>
	<script type="text/javascript" src="./js/progressesButton.js"></script>
	
	<style>
		.fixedHeader{
			overflow:hidden;background: #262626;color:white;text-shadow: none;padding:0px;
		}
		.ui-content{
			border: none;
		}
		.navbar{
            background: #262626;
            text-align: center;
            vertical-align: middle;
			width:100%;
			margin:0px;
			border: none;
        }
        .nav-but{
            height:50px;
            text-align: center;
            vertical-align: middle;
            line-height: 20px;
        }
        .nav-but::after {
            background-size: 20px !important;
            border-radius: 16px;
            width: 32px !important;
            height: 32px !important;
            margin-bottom: 10px;
            margin-left: 20px;
            margin-top: -15px;
        }
		.hide{
			display: none;
		}
		#name{
			text-align: right;
			margin-right: 20px;
			margin-top: 3px;
			line-height: 20px;
			height: 20px;
            min-width: 40px;
            font-size: 16px;
		}
		#main-container{
			position: absolute;
			top:0;
			left:0;
			height: 100%;
			width:100%;
			background: whitesmoke;
			z-index: 1002;
			text-align: center;
			vertical-align: middle;
			
		}
		#main-container h1{
			margin-top: 25%;
			margin-left: 50%;
			vertical-align: middle;
    		transform:translate(-50%,-50%);
		}
		.grid2Column{
			display:grid;
			grid-template-columns: auto auto;
		}
		/* page1  */
		#pageOneTable{
			margin: 0px 10px;
			width:100%;
		}
		#pageOneTable tbody tr td{
            text-align: center;
            vertical-align: middle;
			white-space: nowrap; 
			overflow: hidden;
			text-overflow: ellipsis;

        }
        #pageOneTable thead tr th{
            text-align: center;
            vertical-align: middle;
			white-space: nowrap; 
			overflow: hidden;
			text-overflow: ellipsis;
        }
		#pone_fun_buts{
			top:195px;
            left:15px;
			position: absolute;
		}
		#searchbar1{
			margin-top: 0px;
			margin-left:160px;
			margin-right:80px;
		}
		/* page1  */

		/* page2  */
		#pageSecondTable{
			margin: 10px 10px;
			width:100%;
		}
		#pageSecondTable tbody tr td{
            text-align: left;
            vertical-align:middle;
			white-space: nowrap; 
			overflow: hidden;
			text-overflow: ellipsis;
			
        }
        #pageSecondTable thead tr th{
            text-align: left;
            vertical-align: middle;
			white-space: nowrap; 
			overflow: hidden;
			text-overflow: ellipsis;
        }
		/* page2  */
		.ui-selectmenu.ui-popup .ui-input-search {
    margin-left: .5em;
    margin-right: .5em;
}
.ui-selectmenu.ui-dialog .ui-content {
    padding-top: 0;
}
.ui-selectmenu.ui-dialog .ui-selectmenu-list {
    margin-top: 0;
    background: white;
}
.ui-selectmenu.ui-popup .ui-selectmenu-list li.ui-first-child .ui-btn {
    border-top-width: 1px;
    -webkit-border-radius: 0;
    border-radius: 0;
}
.ui-selectmenu.ui-dialog .ui-header {
    border-bottom-width: 1px;
}
.progress_lock{
			z-index: 99;
			margin-right:10px;
			margin-top: -5px;
			margin-bottom: -5px;
		}
		.ui-but-lock-edit:after{
			background-size: 20px !important;
            border-radius: 16px;
            width: 32px !important;
            height: 32px !important;
			left:9px;
			top:8px;
		}
		.edit-lock{
			margin-right: 10px;
			cursor: pointer;
		}
	</style>
	<script type="text/javascript" src="./utilities/events.js"></script>
</head>
<body>
	
	<div data-role="page" id="main">
		
		<div data-role="header" style="overflow:hidden;background: #262626;color:white;text-shadow: none;padding:0px;" data-position="fixed">
			<h1 style="font-size: 30px;display: flex;margin: 0 0 0 15px;padding:10px;">国瑞法务管理系统</h1>
			<a id="name" href="#popupMenu" data-rel="popup" data-transition="slideup" data-icon="user" class="ui-btn-right">登录</a>
            <div data-role="popup" id="popupMenu" data-theme="b" data-history="false">
                <ul data-role="listview" data-inset="true" style="min-width:160px;" data-theme="b">
                    <li data-role="list-divider">操作</li>
                    <li><a class="ui-btn ui-btn-a ui-btn-icon-left ui-icon-power" onclick='location.href=("index.html")'>退出</a></li>
					<li data-role="list-divider">添加</li>
					<li><a class="ui-btn ui-btn-a ui-btn-icon-left ui-icon-plus popup-add-row">添加一条记录</a></li>
					<li><a class="ui-btn ui-btn-a ui-btn-icon-left ui-icon-plus popup-add-table">添加一条表</a></li>
                </ul>
            </div>

				<div data-role="navbar" id="main_nav">
					<ul>
						<li><a href="#page1" class="ui-btn-active ui-btn ui-icon-bullets ui-btn-icon-left nav-but" data-ajax="false" data-theme="a"><h2>案件登记查询</h2></a></li>
                    	<li><a href="#page2" class="ui-btn ui-icon-star ui-btn-icon-left nav-but" data-ajax="false" data-theme="a"><h2>案件进展执行</h2></a></li>
                    	<li><a href="#page3" class="ui-btn ui-icon-gear ui-btn-icon-left nav-but" data-ajax="false" data-theme="a"><h2>设置</h2></a></li>
					</ul>
				</div><!-- /navbar -->
		</div><!-- /header -->
	
	<div id="page1" class="ui-body-d ui-content">
		
		<div data-role="controlgroup" data-type="horizontal" id="pone_fun_buts">
		</div>
		<table id="pageOneTable" data-role="table" class="ui-responsive table-stroke" data-filter="true" data-input="#filterBasic-input"></table>
	</div>
	<div id="page2" class="hide">
		<table id="pageSecondTable" data-role="table" class="ui-responsive table-stroke" data-filter="true" data-input="#filterBasic-input"></table>
	</div>
	<div id="page3" class="ui-body-d ui-content hide">
		<h1>设置</h1>
		
	</div>
		<div data-role="footer"  data-position="fixed" id="mainFooter">
			<div data-role="controlgroup" data-type="horizontal" class="ui-mini ui-btn-left footerBtn ui-shadow">
				<a href="#fullscreenPage" id="case_reg_but_add" class="ui-btn ui-btn-icon-left ui-icon-plus btn-icon-green case_reg_but">新增</a>
				<a href="#" id="case_reg_but_remove" class="ui-btn ui-btn-icon-left ui-icon-delete btn-icon-red case_reg_but">删除</a>
			</div>
			<div id="searchbar1">
				<form class="ui-filterable filtertable1">
					<input id="filterBasic-input" placeholder="搜索关键字" data-type="search">
				</form>
			</div>
		</div><!-- /footer -->
	</div><!-- /page -->
	
	<!-- Start of second page -->
	<div data-role="page" id="fullscreenPage">
	
		<div data-role="header" data-position="fixed">
				<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-btn-icon-left ui-icon-back btn-icon-blue edit-header-btn" data-rel="back">返回</a>
			<h1 id="reg_form_title">My App</h1>
			<button name="save_btn" class="ui-btn-right ui-btn ui-btn-b ui-btn-inline ui-corner-all ui-btn-icon-right ui-icon-check btn-icon-green edit-header-btn">保存</button>
		</div><!-- /header -->
	
		
			<form role="main" data-ajax="false" id="case_reg_page">

			</form>
		

	</div><!-- /page -->
	<div data-role="page" id="loginPage">
		<h4>登录页面</h4>
		<form>
			<a href="#" class="ui-shadow ui-btn ui-corner-all">登录</a>
		</form>
	</div>
	<div id="main-container">
		<h1>国瑞法务管理系统</h1>
		<div style="display: inline;">
			<div class="fa fa-spinner fa-spin" style="font-size: 40px;color:steelblue;vertical-align:middle;"></div>
			<h3 style="display: inline;margin-left: 10px;vertical-align:middle;">读取中</h3>
		</div>
	</div>
	<script>
		var main_form,pageOnTable,pageSeTable;
		//$.mobile.page.prototype.options.domCache = true;
		//$.mobile.changePage.defaults.reloadPage = true
		$.mobile.navigate( '#');
		//window.location.href = 'text.html';
		getCasesStatus(function(r){
			setGlobalJson("mainDataStatus",r);
		});
		getCasesData(function(r){
            output('getCasesData: ');
            output(r);
            setGlobalJson("mainData",r);
			console.log(FormTemplate3);
			main_form=_createNewCaseForm(FormTemplate3,"case_reg_page");
			getUserList(function(ul){
				console.log('getUserList........'+(ul.length));
				
				//sessionStorage.setItem("userList",JSON.stringify(r));
				setGlobalJson("userList",ul);
				_firstPageTableColumns.caseApplicant.data=getGlobalJson("userList");
				//_initRegTable(r,firstPageTableColumns,"pageOneTable");
				console.log(getGlobalJson("userList"));
				pageOnTable=new pageTable({
					containerId:"pageOneTable",
					template:_firstPageTableColumns,
					data:r,
					//filterParent:"mainFooter",
					rowButtons:'<div data-role="controlgroup" data-type="horizontal" data-mini="true">'+
						'<button name="fn_btn_details" class="btn-icon-green" data-icon="eye" data-iconpos="notext" data-item={0}>查看</button>'+
						'<button href="#fullscreenPage" name="fn_btn_edit" class="btn-icon-blue" data-icon="edit" data-iconpos="notext" data-item={0}>修改</button>'+
						'<button name="fn_btn_delete" class="btn-icon-red" data-icon="delete" data-iconpos="notext" data-item={0}>删除</button>'+
					'</div>'
				});
				console.log('mainDataStatus');
				console.log(getGlobalJson('mainDataStatus'));
				pageSeTable=new pageTable({
					containerId:"pageSecondTable",
					template:_progressTableTemplate,
					data:{0:r,1:getGlobalJson("mainDataStatus")}
					//filterParent:"mainFooter",
				});
				tableColumnToggle(_firstPageTableColumns,"mainFooter","pageOneTable");
				$('#main-container').addClass('hide');
				//$.mobile.hidePageLoadingMsg(); 
				addClickEvents(main_form,r);
				$("#pageOneTable").hpaging({ limit: 10 });
				logingStatus();
				$.each($("#pageOneTable-popup [type=checkbox]"),function(index,checkbox){
					if(index<2){
						console.log($(checkbox).prev().text())
						$(checkbox).prop("checked", false)            /* uncheck it */
									.checkboxradio("refresh")          /* refresh UI */
									.trigger("change");
											}
				});
			});
			
			
            //$("#frame").removeClass('hide');
            
           
			//console.log($("#pageOneTable .ui-checkbox"));
		});

		setGlobal('currentPage',"#page1");
		$(".nav-but").on("click",function(e){
			e.preventDefault();
			if(getGlobal('currentPage') == $(this).attr( "href" )) return;
			$(getGlobal('currentPage')).addClass('hide');
			$($(this).attr( "href" )).removeClass('hide');
			
			//currentPage=$(this).attr( "href" );
			setGlobal('currentPage',$(this).attr( "href" ));
			if(getGlobal('currentPage')!="#page1"){
				$('#searchbar1').animate({'margin-left':"10px",'margin-right':"10px"});
				$('.footerBtn').hide();
			}else{
				$('#searchbar1').animate({'margin-left':"160px",'margin-right':"80px"},function(){
					$('.footerBtn').show();
				});
				
			}
			$("#pageSecondTable").jqmData('filter',getGlobal('currentPage')=="#page2");
			$("#pageOneTable").jqmData('filter',getGlobal('currentPage')=="#page1");
		});
		
		function logingStatus(){
			//setGlobalJson("currentUser","{}");
			if(getGlobalJson("currentUser") && getGlobalJson("currentUser").name){
				$('#name').text(getGlobalJson("currentUser").name);
				
			}else{
				$().minfo('show',{title:"错误",message:"自动跳转到登录页面？"});
				setTimeout(function() {
					window.location.href = 'index.html';
				}, 2000);
			}
		}
		
	</script>
</body>
</html>